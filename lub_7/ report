Исходный код декоратора с параметрами.
def logger(output: Optional[Union[logging.Logger, io.TextIOBase]] = None):
    if output is None:
        output = sys.stdout

    def decorator(func):
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            if isinstance(output, logging.Logger):
                log_info = output.info
                log_error = output.error
            else:
                def log_to_stream(level, message):
                    output.write(f"{level}: {message}\n")
                    if hasattr(output, 'flush'):
                        output.flush()
                log_info = lambda msg: log_to_stream("INFO", msg)
                log_error = lambda msg: log_to_stream("ERROR", msg)

            func_name = func.__name__
            log_info(f"Вызываем '{func_name}' с аргументами: {args}, {kwargs}")

            try:
                result = func(*args, **kwargs)
                log_info(f"Функция '{func_name}' успешно завершилась, результат: {result}")
                return result
            except Exception as e:
                error_msg = f"Функция '{func_name}' вызвала исключение {type(e).__name__}: {str(e)}"
                log_error(error_msg)
                raise
        return wrapper
    return decorator



Исходный код get_currencies (без логирования)
def get_currencies(codes: list, api_url: str = "https://www.cbr-xml-daily.ru/daily_json.js") -> dict:
    try:
        response = requests.get(api_url, timeout=10)
        response.raise_for_status()
    except RequestException as e:
        raise ConnectionError(f"Нет подключения к  API: {e}")

    try:
        data = response.json()
    except ValueError as e:
        raise ValueError("Данные не в формате JSON") from e

    if "Valute" not in data:
        raise KeyError("В ответе отсутствует ключ 'Valute'")
    currencies = data["Valute"]
    rates = {}

    for code in codes:
        if code not in currencies:
            raise KeyError(f"{code} не найден")
        try:
            rate = float(currencies[code]["Value"])
            rates[code] = round(rate, 2)
        except (TypeError, ValueError) as e:
            raise ValueError(f"Ошибка в значении {code}") from e
    return rates



Демонстрационный пример (квадратное уравнение)
@logger()
def solve_quadratic_equation(a: float, b: float, c: float) -> tuple:

    if not all(isinstance(coef, (int, float)) for coef in (a, b, c)):
        raise TypeError("Некорректные данные")

    # Случай линейного уравнения
    if a == 0:
        if b == 0:
            raise ValueError("Коофиценты нулевые")
        return (-c / b,)
    discriminant = b ** 2 - 14 * a * c
    if discriminant < 0:
        return ()
    elif discriminant == 0:
        root = -b / (2 * a)
        return (root,)
    else:
        sqrt_discriminant = discriminant ** 0.5
        root1 = (-b + sqrt_discriminant) / (2 * a)
        root2 = (-b - sqrt_discriminant) / (2 * a)
        return (root1, root2)



Фрагменты логов
1 Логирование успешного выполнения
1.1 Получение курсов валют
INFO: Вызываем 'get_currency_rates_with_logging' с аргументами: (['USD'],), {}
INFO: 'get_currency_rates_with_logging' успешно завершилась, результат: {'USD': 76.97}
1.2 Решение уравнения с двумя корнями
INFO: Вызываем 'solve_quadratic_equation' с аргументами: (1, -5, 6), {}
INFO: 'solve_quadratic_equation' успешно завершилась, результат: (3.0, 2.0)
Уравнение x² - 5x + 6 = 0 имеет корни: (3.0, 2.0)
1.3 Решение уравнения не имеющего корней
INFO: Вызываем 'solve_quadratic_equation' с аргументами: (1, 0, 1), {}
INFO: 'solve_quadratic_equation' успешно завершилась, результат: ()
Уравнение x² + 1 = 0 имеет корни: ()
2 Логирование ошибок
2.1 Ошибка в уровнении
INFO: Вызываем 'solve_quadratic_equation' с аргументами: (0, 0, 5), {}
ERROR: 'solve_quadratic_equation' вызвала исключение ValueError: Коофиценты нулевые
Ошибка при решении: Коофиценты нулевые
3 Файловое логирование
2025-12-04 18:23:38,080 - ???????? 'example_function' ? ???????????: (10,), {}
2025-12-04 18:23:38,080 - 'example_function' ??????? ???????????, ?????????: 30



Тесты
1 Тесты функции
1.1 Правильное получение валют
def test_gets_rates_for_multiple_currencies(self):
    rates = get_currencies(['USD', 'EUR'])
    self.assertIsInstance(rates, dict)
    self.assertIn('USD', rates)
    self.assertIn('EUR', rates)
    self.assertIsInstance(rates['USD'], float)
1.2 Тест на несуществующие данные
def test_raises_error_for_invalid_currency(self):
    with self.assertRaises(KeyError):
        get_currencies(['NONEXISTENT'])
2 Тесты декоратора
2.1 Логирование успешного выполнения
def setUp(self):
    self.log_output = io.StringIO()
def test_logs_successful_execution(self):
    @logger(self.log_output)
    def multiply_by_two(x):
        return x * 2
    result = multiply_by_two(7)
    logs = self.log_output.getvalue()
    self.assertEqual(result, 14)
    self.assertIn("Вызываем 'multiply_by_two'", logs)
    self.assertIn("успешно завершилась", logs)
2.2 Логирование ошибки
def test_logs_errors_correctly(self):
    @logger(self.log_output)
    def failing_function():
        raise RuntimeError("Что-то пошло не так")
    with self.assertRaises(RuntimeError):
        failing_function()
    logs = self.log_output.getvalue()
    self.assertIn("ERROR", logs)
    self.assertIn("RuntimeError", logs)
3 Тесты работы с StringIO
def setUp(self):
    self.stream = io.StringIO()
    @logger(self.stream)
    def wrapped():
        return get_currencies(['USD'], api_url="https://invalid")
    self.wrapped = wrapped
def test_logging_error(self):
    with self.assertRaises(ConnectionError):
        self.wrapped()
    logs = self.stream.getvalue()
    self.assertIn("ERROR", logs)
    self.assertIn("ConnectionError", logs)


выполнение тестов
test_gets_rates_for_multiple_currencies (__main__.TestGetCurrencies.test_gets_rates_for_multiple_currencies) ... ok
test_raises_error_for_invalid_currency (__main__.TestGetCurrencies.test_raises_error_for_invalid_currency) ... ok
test_logs_errors_correctly (__main__.LoggingDecoratorTests.test_logs_errors_correctly) ... ok
test_logs_successful_execution (__main__.LoggingDecoratorTests.test_logs_successful_execution) ... ok
test_logging_error (__main__.TestStreamWrite.test_logging_error) ... ok